<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo MongoDB - API REST Blog</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.95;
            margin: 5px 0;
        }

        .header-badges {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
        }

        .nav-tabs {
            display: flex;
            background: #f5f5f5;
            padding: 0;
            margin: 0;
            overflow-x: auto;
            border-bottom: 3px solid #667eea;
        }

        .nav-tab {
            flex: 1;
            min-width: 150px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            font-size: 1em;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
            border-right: 1px solid #ddd;
        }

        .nav-tab:hover {
            background: #e0e0e0;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
            margin-bottom: -3px;
        }

        .content {
            padding: 40px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            font-size: 2em;
        }

        .endpoint-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            margin: 20px 0;
            overflow: hidden;
            transition: all 0.3s;
        }

        .endpoint-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .endpoint-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .endpoint-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .method {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .get { background: #61affe; color: white; }
        .post { background: #49cc90; color: white; }
        .put { background: #fca130; color: white; }
        .delete { background: #f93e3e; color: white; }

        .url {
            font-family: 'Fira Code', 'Courier New', monospace;
            background: #2d2d2d;
            color: #4ec9b0;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 0.95em;
            flex: 1;
            min-width: 200px;
        }

        .description {
            color: #555;
            line-height: 1.8;
            font-size: 1em;
            margin-top: 10px;
        }

        .endpoint-body {
            padding: 20px;
        }

        .code-section {
            margin: 20px 0;
        }

        .code-label {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            position: relative;
            border: 1px solid #333;
        }

        .mongodb-query {
            background: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
        }

        .mongodb-query-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
            font-size: 1.05em;
        }

        .btn-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 0.95em;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-test {
            background: #667eea;
            color: white;
        }

        .btn-test:hover {
            background: #5568d3;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            background: #e8f5e9;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            display: none;
            max-height: 500px;
            overflow-y: auto;
        }

        .result.show {
            display: block;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 500px; }
        }

        .result.error {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .result pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
        }

        .highlight-mongodb {
            background: linear-gradient(135deg, #13aa52 0%, #00ed64 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .highlight-mongodb h3 {
            color: white;
            margin-bottom: 10px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .comparison-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .comparison-table tr:last-child td {
            border-bottom: none;
        }

        .comparison-table tr:hover {
            background: #f5f5f5;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .card h4 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ Demo MongoDB - API REST Blog</h1>
            <p>Demostraci√≥n Completa de MongoDB Query Language (MQL) y BSON</p>
            <p><strong>Base URL:</strong> http://localhost:3900/api</p>
            <div class="header-badges">
                <span class="badge">üìä MongoDB 9.0</span>
                <span class="badge">üü¢ Node.js + Express</span>
                <span class="badge">üî• Mongoose ODM</span>
                <span class="badge">‚ö° BSON Format</span>
            </div>
        </header>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('intro')">üè† Intro MQL/BSON</button>
            <button class="nav-tab" onclick="switchTab('crud')">üìù CRUD</button>
            <button class="nav-tab" onclick="switchTab('advanced')">üîç Consultas Avanzadas</button>
            <button class="nav-tab" onclick="switchTab('aggregation')">üìä Aggregation</button>
            <button class="nav-tab" onclick="switchTab('indices')">üóÇÔ∏è √çndices</button>
        </div>

        <div class="content">
            <!-- TAB: INTRODUCCI√ìN MQL/BSON -->
            <div id="tab-intro" class="tab-content active">
                <div class="section">
                    <h2>üéØ MongoDB Query Language (MQL) y BSON</h2>
                    
                    <div class="highlight-mongodb">
                        <h3>üçÉ ¬øQu√© hace especial a MongoDB?</h3>
                        <p style="font-size: 1.1em; line-height: 1.8;">
                            MongoDB utiliza <strong>BSON (Binary JSON)</strong> como formato de almacenamiento y 
                            <strong>MQL (MongoDB Query Language)</strong> para consultas, ofreciendo una experiencia 
                            intuitiva y poderosa basada en documentos JSON.
                        </p>
                    </div>

                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th style="width: 25%;">Caracter√≠stica</th>
                                <th style="width: 37.5%;">SQL Tradicional</th>
                                <th style="width: 37.5%;">MongoDB (MQL + BSON)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Formato</strong></td>
                                <td>Tablas con filas y columnas</td>
                                <td>Colecciones con documentos BSON</td>
                            </tr>
                            <tr>
                                <td><strong>Esquema</strong></td>
                                <td>R√≠gido, predefinido</td>
                                <td>Flexible, din√°mico</td>
                            </tr>
                            <tr>
                                <td><strong>Consulta Simple</strong></td>
                                <td><code>SELECT * FROM users WHERE age > 18</code></td>
                                <td><code>{ age: { $gt: 18 } }</code></td>
                            </tr>
                            <tr>
                                <td><strong>Inserci√≥n</strong></td>
                                <td><code>INSERT INTO users (name, age) VALUES ('Juan', 25)</code></td>
                                <td><code>{ name: "Juan", age: 25 }</code></td>
                            </tr>
                            <tr>
                                <td><strong>Tipos de Datos</strong></td>
                                <td>INT, VARCHAR, DATE</td>
                                <td>String, Number, Date, ObjectId, Array, Object</td>
                            </tr>
                            <tr>
                                <td><strong>Agregaci√≥n</strong></td>
                                <td><code>GROUP BY, HAVING, JOIN</code></td>
                                <td>Pipeline: <code>$match, $group, $project</code></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="grid">
                        <div class="card">
                            <h4>üì¶ BSON - Binary JSON</h4>
                            <p>Formato binario optimizado que extiende JSON con:</p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>ObjectId:</strong> IDs √∫nicos de 12 bytes</li>
                                <li><strong>Date:</strong> Timestamps precisos</li>
                                <li><strong>Binary:</strong> Datos binarios eficientes</li>
                                <li><strong>Performance:</strong> 2-3x m√°s r√°pido que JSON</li>
                            </ul>
                        </div>
                        <div class="card">
                            <h4>üîç MQL - Query Language</h4>
                            <p>Lenguaje de consultas basado en JSON que permite:</p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>Sintaxis intuitiva:</strong> Similar a JavaScript</li>
                                <li><strong>Operadores ricos:</strong> $gt, $in, $regex, etc.</li>
                                <li><strong>Consultas complejas:</strong> Nested queries</li>
                                <li><strong>Aggregation:</strong> Pipeline poderoso</li>
                            </ul>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>üí° Ejemplo de BSON en Acci√≥n</h4>
                        <p>Cuando env√≠as este JSON:</p>
                        <div class="code-block" style="margin-top: 10px;">
{
  "titulo": "Mi art√≠culo",
  "fecha": "2025-12-14",
  "autor": "Juan"
}
                        </div>
                        <p style="margin-top: 10px;">MongoDB lo almacena como BSON con:</p>
                        <div class="code-block" style="margin-top: 10px;">
{
  "_id": ObjectId("675d1234567890abcdef1234"),
  "titulo": "Mi art√≠culo",
  "fecha": ISODate("2025-12-14T00:00:00Z"),
  "autor": "Juan"
}
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: CRUD B√ÅSICO -->
            <div id="tab-crud" class="tab-content">
                <div class="section">
                    <h2>üìù Operaciones CRUD con MQL</h2>

                    <!-- CREATE -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method post">POST</span>
                                <span class="url">/api/articulo</span>
                            </div>
                            <div class="description">
                                <strong>CREATE:</strong> Inserta un nuevo documento en la colecci√≥n "articulos"
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="code-section">
                                <div class="code-label">üì§ Request Body (JSON ‚Üí BSON):</div>
                                <div class="code-block">{
  "titulo": "Introducci√≥n a MongoDB",
  "contenido": "MongoDB es una base de datos NoSQL orientada a documentos...",
  "autor": "Juan P√©rez",
  "categoria": "Tecnolog√≠a"
}</div>
                            </div>

                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL Equivalente:</div>
                                <div class="code-block">db.articulos.insertOne({
  titulo: "Introducci√≥n a MongoDB",
  contenido: "MongoDB es una base de datos NoSQL orientada a documentos...",
  autor: "Juan P√©rez",
  categoria: "Tecnolog√≠a",
  fecha: new Date(),
  visitas: 0,
  publicado: true
})</div>
                            </div>

                            <div class="code-section">
                                <div class="code-label">üì• Response (BSON ‚Üí JSON):</div>
                                <div class="code-block">{
  "status": "success",
  "message": "Art√≠culo creado correctamente",
  "articulo": {
    "_id": "675d1234567890abcdef1234",
    "titulo": "Introducci√≥n a MongoDB",
    "contenido": "MongoDB es una base de datos NoSQL...",
    "autor": "Juan P√©rez",
    "categoria": "Tecnolog√≠a",
    "fecha": "2025-12-14T12:00:00.000Z",
    "visitas": 0,
    "publicado": true
  }
}</div>
                            </div>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testCrear()">üß™ Probar CREATE</button>
                            </div>
                            <div id="result-crear" class="result"></div>
                        </div>
                    </div>

                    <!-- READ -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/articulo</span>
                            </div>
                            <div class="description">
                                <strong>READ:</strong> Obtiene todos los documentos de la colecci√≥n
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL Equivalente:</div>
                                <div class="code-block">db.articulos.find({}).sort({ fecha: -1 })</div>
                                <p style="margin-top: 10px; color: #555;">
                                    <code>{}</code> = sin filtros (todos los documentos)<br>
                                    <code>.sort({ fecha: -1 })</code> = ordenar por fecha descendente
                                </p>
                            </div>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testListar()">üß™ Probar READ</button>
                            </div>
                            <div id="result-listar" class="result"></div>
                        </div>
                    </div>

                    <!-- UPDATE -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method put">PUT</span>
                                <span class="url">/api/articulo/:id</span>
                            </div>
                            <div class="description">
                                <strong>UPDATE:</strong> Actualiza un documento espec√≠fico
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="code-section">
                                <div class="code-label">üì§ Request Body:</div>
                                <div class="code-block">{
  "titulo": "T√≠tulo actualizado",
  "contenido": "Contenido modificado",
  "categoria": "Ciencia"
}</div>
                            </div>

                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL Equivalente:</div>
                                <div class="code-block">db.articulos.findByIdAndUpdate(
  "675d1234567890abcdef1234",
  {
    $set: {
      titulo: "T√≠tulo actualizado",
      contenido: "Contenido modificado",
      categoria: "Ciencia"
    }
  },
  { new: true, runValidators: true }
)</div>
                                <p style="margin-top: 10px; color: #555;">
                                    <code>$set</code> = operador para actualizar campos espec√≠ficos<br>
                                    <code>new: true</code> = devuelve el documento actualizado<br>
                                    <code>runValidators: true</code> = valida seg√∫n el esquema
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- DELETE -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method delete">DELETE</span>
                                <span class="url">/api/articulo/:id</span>
                            </div>
                            <div class="description">
                                <strong>DELETE:</strong> Elimina un documento por su ObjectId
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL Equivalente:</div>
                                <div class="code-block">db.articulos.findByIdAndDelete("675d1234567890abcdef1234")</div>
                                <p style="margin-top: 10px; color: #555;">
                                    Elimina el documento con el <code>_id</code> especificado
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: CONSULTAS AVANZADAS -->
            <div id="tab-advanced" class="tab-content">
                <div class="section">
                    <h2>üîç Consultas Avanzadas con MQL</h2>

                    <!-- B√∫squeda por texto -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/buscar/texto?texto=mongodb</span>
                            </div>
                            <div class="description">
                                <strong>Text Search:</strong> B√∫squeda de texto completo con √≠ndices
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL Equivalente:</div>
                                <div class="code-block">db.articulos.find(
  { $text: { $search: "mongodb" } },
  { score: { $meta: "textScore" } }
).sort({ score: { $meta: "textScore" } })</div>
                                <p style="margin-top: 10px; color: #555;">
                                    <code>$text</code> = operador de b√∫squeda de texto<br>
                                    <code>$search</code> = t√©rmino(s) a buscar<br>
                                    <code>$meta: "textScore"</code> = score de relevancia
                                </p>
                            </div>

                            <div class="info-box">
                                <strong>üí° Requiere √≠ndice de texto:</strong>
                                <div class="code-block" style="margin-top: 10px;">
db.articulos.createIndex({ titulo: "text", contenido: "text" })
                                </div>
                            </div>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testBuscarTexto()">üß™ Probar Text Search</button>
                            </div>
                            <div id="result-texto" class="result"></div>
                        </div>
                    </div>

                    <!-- Operadores l√≥gicos -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/buscar/operadores?operador=or&categoria1=Tecnolog√≠a</span>
                            </div>
                            <div class="description">
                                <strong>Operadores L√≥gicos:</strong> $and, $or, $not, $nor
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL con $or:</div>
                                <div class="code-block">db.articulos.find({
  $or: [
    { categoria: "Tecnolog√≠a" },
    { categoria: "Ciencia" }
  ]
})</div>
                            </div>

                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL con $and:</div>
                                <div class="code-block">db.articulos.find({
  $and: [
    { categoria: "Tecnolog√≠a" },
    { visitas: { $gte: 10 } },
    { publicado: true }
  ]
})</div>
                            </div>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testOperadores()">üß™ Probar $or</button>
                            </div>
                            <div id="result-operadores" class="result"></div>
                        </div>
                    </div>

                    <!-- Operadores de comparaci√≥n -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/buscar/comparacion?visitasMin=5&visitasMax=100</span>
                            </div>
                            <div class="description">
                                <strong>Operadores de Comparaci√≥n:</strong> $gt, $gte, $lt, $lte, $in, $ne
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL Equivalente:</div>
                                <div class="code-block">db.articulos.find({
  visitas: {
    $gte: 5,    // Mayor o igual a 5
    $lte: 100   // Menor o igual a 100
  },
  categoria: {
    $in: ["Tecnolog√≠a", "Ciencia"]  // En la lista
  }
}).sort({ visitas: -1 })</div>
                            </div>

                            <table class="comparison-table" style="margin-top: 20px;">
                                <thead>
                                    <tr>
                                        <th>Operador</th>
                                        <th>Significado</th>
                                        <th>Ejemplo MQL</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>$gt</code></td>
                                        <td>Mayor que (>)</td>
                                        <td><code>{ visitas: { $gt: 10 } }</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>$gte</code></td>
                                        <td>Mayor o igual (>=)</td>
                                        <td><code>{ visitas: { $gte: 10 } }</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>$lt</code></td>
                                        <td>Menor que (<)</td>
                                        <td><code>{ visitas: { $lt: 100 } }</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>$lte</code></td>
                                        <td>Menor o igual (<=)</td>
                                        <td><code>{ visitas: { $lte: 100 } }</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>$in</code></td>
                                        <td>En la lista</td>
                                        <td><code>{ categoria: { $in: ["Tech", "Sci"] } }</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>$ne</code></td>
                                        <td>No igual (!=)</td>
                                        <td><code>{ status: { $ne: "deleted" } }</code></td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testComparacion()">üß™ Probar Comparadores</button>
                            </div>
                            <div id="result-comparacion" class="result"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: AGGREGATION PIPELINE -->
            <div id="tab-aggregation" class="tab-content">
                <div class="section">
                    <h2>üìä Aggregation Pipeline</h2>

                    <div class="info-box">
                        <h4>üî• ¬øQu√© es Aggregation Pipeline?</h4>
                        <p>Un framework para procesamiento de datos que permite transformar y analizar documentos 
                        mediante una secuencia de etapas (stages). Similar a tuber√≠as en Unix.</p>
                    </div>

                    <!-- Estad√≠sticas por categor√≠a -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/estadisticas/categoria</span>
                            </div>
                            <div class="description">
                                <strong>Aggregation:</strong> Estad√≠sticas agrupadas por categor√≠a
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Aggregation Pipeline Completo:</div>
                                <div class="code-block">db.articulos.aggregate([
  // Stage 1: $match - Filtrar documentos
  {
    $match: { publicado: true }
  },
  
  // Stage 2: $group - Agrupar y calcular
  {
    $group: {
      _id: "$categoria",
      total: { $sum: 1 },
      totalVisitas: { $sum: "$visitas" },
      promedioVisitas: { $avg: "$visitas" },
      visitasMax: { $max: "$visitas" },
      visitasMin: { $min: "$visitas" }
    }
  },
  
  // Stage 3: $project - Seleccionar campos
  {
    $project: {
      _id: 0,
      categoria: "$_id",
      totalArticulos: "$total",
      totalVisitas: 1,
      promedioVisitas: { $round: ["$promedioVisitas", 2] },
      visitasMax: 1,
      visitasMin: 1
    }
  },
  
  // Stage 4: $sort - Ordenar resultados
  {
    $sort: { totalArticulos: -1 }
  }
])</div>
                            </div>

                            <div class="grid" style="margin-top: 20px;">
                                <div class="card">
                                    <h4>üìå $match</h4>
                                    <p>Filtra documentos como <code>find()</code></p>
                                    <div class="code-block" style="margin-top: 10px;">
{ $match: { publicado: true } }
                                    </div>
                                </div>
                                <div class="card">
                                    <h4>üìä $group</h4>
                                    <p>Agrupa y calcula estad√≠sticas</p>
                                    <div class="code-block" style="margin-top: 10px;">
{
  $group: {
    _id: "$categoria",
    total: { $sum: 1 },
    avg: { $avg: "$visitas" }
  }
}
                                    </div>
                                </div>
                                <div class="card">
                                    <h4>üéØ $project</h4>
                                    <p>Selecciona y transforma campos</p>
                                    <div class="code-block" style="margin-top: 10px;">
{
  $project: {
    _id: 0,
    nombre: "$_id",
    total: 1
  }
}
                                    </div>
                                </div>
                                <div class="card">
                                    <h4>üìâ $sort</h4>
                                    <p>Ordena resultados</p>
                                    <div class="code-block" style="margin-top: 10px;">
{ $sort: { total: -1 } }
// -1 = descendente
// 1 = ascendente
                                    </div>
                                </div>
                            </div>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testEstadisticas()">üß™ Probar Aggregation</button>
                            </div>
                            <div id="result-estadisticas" class="result"></div>
                        </div>
                    </div>

                    <!-- Art√≠culos m√°s vistos -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/estadisticas/mas-vistos?limite=5</span>
                            </div>
                            <div class="description">
                                <strong>Aggregation con $limit:</strong> Top art√≠culos m√°s visitados
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Pipeline con $limit:</div>
                                <div class="code-block">db.articulos.aggregate([
  { $match: { publicado: true } },
  { $sort: { visitas: -1 } },
  { $limit: 5 },
  {
    $project: {
      titulo: 1,
      autor: 1,
      categoria: 1,
      visitas: 1,
      fecha: 1
    }
  }
])</div>
                            </div>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testMasVistos()">üß™ Probar Top 5</button>
                            </div>
                            <div id="result-masvistos" class="result"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: √çNDICES -->
            <div id="tab-indices" class="tab-content">
                <div class="section">
                    <h2>üóÇÔ∏è √çndices en MongoDB</h2>

                    <div class="highlight-mongodb">
                        <h3>‚ö° Optimizaci√≥n con √çndices</h3>
                        <p>Los √≠ndices mejoran dram√°ticamente el rendimiento de las consultas al crear estructuras 
                        de datos especiales que permiten b√∫squedas r√°pidas.</p>
                    </div>

                    <div class="grid">
                        <div class="card">
                            <h4>üéØ √çndice de Texto</h4>
                            <p><strong>Prop√≥sito:</strong> B√∫squedas full-text</p>
                            <div class="code-block" style="margin-top: 10px;">
db.articulos.createIndex({
  titulo: "text",
  contenido: "text"
})
                            </div>
                            <p style="margin-top: 10px; color: #555;">
                                Permite b√∫squedas como: <code>$text: { $search: "mongodb" }</code>
                            </p>
                        </div>

                        <div class="card">
                            <h4>üìÖ √çndice Simple</h4>
                            <p><strong>Prop√≥sito:</strong> Ordenamiento r√°pido</p>
                            <div class="code-block" style="margin-top: 10px;">
db.articulos.createIndex({
  fecha: -1
})
                            </div>
                            <p style="margin-top: 10px; color: #555;">
                                Optimiza: <code>.sort({ fecha: -1 })</code>
                            </p>
                        </div>

                        <div class="card">
                            <h4>üîó √çndice Compuesto</h4>
                            <p><strong>Prop√≥sito:</strong> Consultas multi-campo</p>
                            <div class="code-block" style="margin-top: 10px;">
db.articulos.createIndex({
  categoria: 1,
  fecha: -1
})
                            </div>
                            <p style="margin-top: 10px; color: #555;">
                                Optimiza: consultas por categor√≠a + ordenamiento por fecha
                            </p>
                        </div>
                    </div>

                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/indices/info</span>
                            </div>
                            <div class="description">
                                <strong>Ver √çndices:</strong> Lista todos los √≠ndices de la colecci√≥n
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Comando MongoDB:</div>
                                <div class="code-block">db.articulos.getIndexes()</div>
                            </div>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testIndices()">üß™ Ver √çndices</button>
                            </div>
                            <div id="result-indices" class="result"></div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>üí° Impacto en el Rendimiento</h4>
                        <table class="comparison-table" style="margin-top: 10px;">
                            <thead>
                                <tr>
                                    <th>Operaci√≥n</th>
                                    <th>Sin √çndice</th>
                                    <th>Con √çndice</th>
                                    <th>Mejora</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>B√∫squeda simple</td>
                                    <td>O(n) - Escaneo completo</td>
                                    <td>O(log n)</td>
                                    <td>100-1000x m√°s r√°pido</td>
                                </tr>
                                <tr>
                                    <td>Ordenamiento</td>
                                    <td>O(n log n) en memoria</td>
                                    <td>O(1) con √≠ndice</td>
                                    <td>10-100x m√°s r√°pido</td>
                                </tr>
                                <tr>
                                    <td>Text Search</td>
                                    <td>No disponible</td>
                                    <td>O(log n)</td>
                                    <td>Imposible sin √≠ndice</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3900/api';

        function switchTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Mostrar el tab seleccionado
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showResult(elementId, data, isError = false) {
            const resultDiv = document.getElementById(elementId);
            resultDiv.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            resultDiv.classList.add('show');
            if (isError) {
                resultDiv.classList.add('error');
            } else {
                resultDiv.classList.remove('error');
            }
        }

        async function testCrear() {
            try {
                const response = await fetch(`${API_URL}/articulo`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        titulo: `Art√≠culo sobre MongoDB ${Date.now()}`,
                        contenido: 'MongoDB utiliza BSON para almacenar documentos de forma eficiente. Esto permite consultas r√°pidas y flexibles.',
                        autor: 'Usuario Demo',
                        categoria: 'Tecnolog√≠a'
                    })
                });
                const data = await response.json();
                showResult('result-crear', data);
            } catch (error) {
                showResult('result-crear', { error: error.message }, true);
            }
        }

        async function testListar() {
            try {
                const response = await fetch(`${API_URL}/articulo`);
                const data = await response.json();
                showResult('result-listar', data);
            } catch (error) {
                showResult('result-listar', { error: error.message }, true);
            }
        }

        async function testBuscarTexto() {
            try {
                const response = await fetch(`${API_URL}/buscar/texto?texto=mongodb`);
                const data = await response.json();
                showResult('result-texto', data);
            } catch (error) {
                showResult('result-texto', { error: error.message }, true);
            }
        }

        async function testOperadores() {
            try {
                const response = await fetch(`${API_URL}/buscar/operadores?operador=or&categoria1=Tecnolog√≠a&categoria2=Ciencia`);
                const data = await response.json();
                showResult('result-operadores', data);
            } catch (error) {
                showResult('result-operadores', { error: error.message }, true);
            }
        }

        async function testComparacion() {
            try {
                const response = await fetch(`${API_URL}/buscar/comparacion?visitasMin=0&visitasMax=1000&categorias=Tecnolog√≠a,Ciencia`);
                const data = await response.json();
                showResult('result-comparacion', data);
            } catch (error) {
                showResult('result-comparacion', { error: error.message }, true);
            }
        }

        async function testEstadisticas() {
            try {
                const response = await fetch(`${API_URL}/estadisticas/categoria`);
                const data = await response.json();
                showResult('result-estadisticas', data);
            } catch (error) {
                showResult('result-estadisticas', { error: error.message }, true);
            }
        }

        async function testMasVistos() {
            try {
                const response = await fetch(`${API_URL}/estadisticas/mas-vistos?limite=5`);
                const data = await response.json();
                showResult('result-masvistos', data);
            } catch (error) {
                showResult('result-masvistos', { error: error.message }, true);
            }
        }

        async function testIndices() {
            try {
                const response = await fetch(`${API_URL}/indices/info`);
                const data = await response.json();
                showResult('result-indices', data);
            } catch (error) {
                showResult('result-indices', { error: error.message }, true);
            }
        }
    </script>
</body>
</html>
