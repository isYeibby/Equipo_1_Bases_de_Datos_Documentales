<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Interactivo MongoDB - API REST Blog</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header>
            <h1>MongoDB</h1>
            <p>Demostraci√≥n Completa de MongoDB Query Language (MQL) y BSON</p>
            <p><strong>Base URL:</strong> http://localhost:3900/api</p>
        </header>

        <!-- NAVIGATION TABS -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="crud">CRUD</button>
            <button class="nav-tab" data-tab="search">B√∫squedas</button>
            <button class="nav-tab" data-tab="advanced">Consultas Avanzadas</button>
            <button class="nav-tab" data-tab="aggregation">Aggregation</button>
            <button class="nav-tab" data-tab="intro">Intro MQL/BSON</button>
        </div>

        <div class="content">
            <!-- ==================== TAB: CRUD INTERACTIVO ==================== -->
            <div id="tab-crud" class="tab-content active">
                <div class="section">
                    <h2>CRUD Interactivo - Gestiona tus Art√≠culos</h2>

                    <!-- CREATE: Formulario Interactivo -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method post">POST</span>
                                <span class="url">/api/articulo</span>
                            </div>
                            <div class="description">
                                <strong>CREATE:</strong> Crea un nuevo art√≠culo completando el formulario
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <form id="form-create" class="interactive-form">
                                <div class="form-group">
                                    <label for="create-titulo">T√≠tulo del Art√≠culo *</label>
                                    <input 
                                        type="text" 
                                        id="create-titulo" 
                                        placeholder="Ej: Introducci√≥n a MongoDB" 
                                        required
                                    >
                                </div>

                                <div class="form-group">
                                    <label for="create-contenido">Contenido *</label>
                                    <textarea 
                                        id="create-contenido" 
                                        placeholder="Escribe el contenido de tu art√≠culo aqu√≠..."
                                        required
                                    ></textarea>
                                </div>

                                <div class="form-group">
                                    <label for="create-autor">Autor *</label>
                                    <input 
                                        type="text" 
                                        id="create-autor" 
                                        placeholder="Ej: Juan P√©rez"
                                        required
                                    >
                                </div>

                                <div class="form-group">
                                    <label for="create-categoria">Categor√≠a</label>
                                    <select id="create-categoria">
                                        <option value="Tecnolog√≠a">Tecnolog√≠a</option>
                                        <option value="Ciencia">Ciencia</option>
                                        <option value="Educaci√≥n">Educaci√≥n</option>
                                        <option value="Deportes">Deportes</option>
                                        <option value="Arte">Arte</option>
                                        <option value="Salud">Salud</option>
                                    </select>
                                </div>

                                <div class="btn-container">
                                    <button type="submit" id="create-btn" class="btn-primary">
                                        Crear Art√≠culo
                                    </button>
                                </div>
                            </form>

                            <div class="mongodb-query">
                                <div class="mongodb-query-title">Query MQL que se ejecuta:</div>
                                <div class="code-block">db.articulos.insertOne({
  titulo: "Tu t√≠tulo aqu√≠",
  contenido: "Tu contenido aqu√≠",
  autor: "Tu nombre aqu√≠",
  categoria: "Categor√≠a seleccionada",
  fecha: new Date(),
  visitas: 0,
  publicado: true
})</div>
                            </div>

                            <div id="result-create" class="result"></div>
                        </div>
                    </div>

                    <!-- READ: Visualizaci√≥n de Art√≠culos -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/articulo</span>
                            </div>
                            <div class="description">
                                <strong>READ:</strong> Visualiza todos los art√≠culos creados
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">Query MQL Equivalente:</div>
                                <div class="code-block">db.articulos.find({}).sort({ fecha: -1 })</div>
                            </div>

                            <div class="btn-container">
                                <button class="btn-refresh" onclick="loadArticles()">
                                    Recargar Art√≠culos
                                </button>
                            </div>

                            <div id="articles-grid" class="articles-grid">
                                <!-- Los art√≠culos se cargan aqu√≠ din√°micamente -->
                            </div>
                        </div>
                    </div>

                    <!-- DELETE: Resultado -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method delete">DELETE</span>
                                <span class="url">/api/articulo/:id</span>
                            </div>
                            <div class="description">
                                <strong>DELETE:</strong> Elimina un art√≠culo
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL Equivalente:</div>
                                <div class="code-block">db.articulos.findByIdAndDelete("675d1234567890abcdef1234")</div>
                            </div>

                            <div id="result-delete" class="result"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== TAB: B√öSQUEDAS ==================== -->
            <div id="tab-search" class="tab-content">
                <div class="section">
                    <h2>B√∫squedas Avanzadas</h2>

                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/buscar/*</span>
                            </div>
                            <div class="description">
                                <strong>SEARCH:</strong> Busca art√≠culos por texto, categor√≠a o autor
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <form id="form-search" class="interactive-form">
                                <div class="form-group">
                                    <label for="search-type">Tipo de B√∫squeda</label>
                                    <select id="search-type">
                                        <option value="texto">B√∫squeda de texto completo</option>
                                        <option value="categoria">Por categor√≠a</option>
                                        <option value="autor">Por autor</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="search-text">T√©rmino de B√∫squeda</label>
                                    <input 
                                        type="text" 
                                        id="search-text" 
                                        placeholder="Escribe lo que quieres buscar..."
                                        required
                                    >
                                </div>

                                <div class="btn-container">
                                    <button type="submit" id="search-btn" class="btn-primary">
                                        Buscar
                                    </button>
                                </div>
                            </form>

                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL para B√∫squeda de Texto:</div>
                                <div class="code-block">db.articulos.find(
  { $text: { $search: "t√©rmino" } },
  { score: { $meta: "textScore" } }
).sort({ score: { $meta: "textScore" } })</div>
                            </div>

                            <div id="search-results" class="search-results">
                                <!-- Resultados aqu√≠ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== TAB: CONSULTAS AVANZADAS ==================== -->
            <div id="tab-advanced" class="tab-content">
                <div class="section">
                    <h2>Consultas Avanzadas con Operadores MQL</h2>

                    <!-- Operadores L√≥gicos -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/buscar/operadores</span>
                            </div>
                            <div class="description">
                                <strong>Operadores L√≥gicos:</strong> $and, $or, $not, $nor
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL con $or:</div>
                                <div class="code-block">db.articulos.find({
  $or: [
    { categoria: "Tecnolog√≠a" },
    { categoria: "Ciencia" }
  ]
})</div>
                            </div>

                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL con $and:</div>
                                <div class="code-block">db.articulos.find({
  $and: [
    { categoria: "Tecnolog√≠a" },
    { visitas: { $gte: 10 } },
    { publicado: true }
  ]
})</div>
                            </div>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testOperadores()">
                                    Probar Operador $or
                                </button>
                            </div>
                            <div id="result-operadores" class="result"></div>
                        </div>
                    </div>

                    <!-- Operadores de Comparaci√≥n -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/buscar/comparacion</span>
                            </div>
                            <div class="description">
                                <strong>Operadores de Comparaci√≥n:</strong> $gt, $gte, $lt, $lte, $in, $ne
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL Equivalente:</div>
                                <div class="code-block">db.articulos.find({
  visitas: {
    $gte: 5,    // Mayor o igual a 5
    $lte: 100   // Menor o igual a 100
  },
  categoria: {
    $in: ["Tecnolog√≠a", "Ciencia"]  // En la lista
  }
}).sort({ visitas: -1 })</div>
                            </div>

                            <table class="comparison-table" style="margin-top: 20px;">
                                <thead>
                                    <tr>
                                        <th>Operador</th>
                                        <th>Significado</th>
                                        <th>Ejemplo MQL</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>$gt</code></td>
                                        <td>Mayor que (>)</td>
                                        <td><code>{ visitas: { $gt: 10 } }</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>$gte</code></td>
                                        <td>Mayor o igual (>=)</td>
                                        <td><code>{ visitas: { $gte: 10 } }</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>$lt</code></td>
                                        <td>Menor que (<)</td>
                                        <td><code>{ visitas: { $lt: 100 } }</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>$lte</code></td>
                                        <td>Menor o igual (<=)</td>
                                        <td><code>{ visitas: { $lte: 100 } }</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>$in</code></td>
                                        <td>En la lista</td>
                                        <td><code>{ categoria: { $in: ["Tech", "Sci"] } }</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>$ne</code></td>
                                        <td>No igual (!=)</td>
                                        <td><code>{ status: { $ne: "deleted" } }</code></td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testComparacion()">
                                    Probar Comparadores
                                </button>
                            </div>
                            <div id="result-comparacion" class="result"></div>
                        </div>
                    </div>

                    <!-- B√∫squeda de Texto -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/buscar/texto?texto=mongodb</span>
                            </div>
                            <div class="description">
                                <strong>Text Search:</strong> B√∫squeda de texto completo con √≠ndices
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Query MQL Equivalente:</div>
                                <div class="code-block">db.articulos.find(
  { $text: { $search: "mongodb" } },
  { score: { $meta: "textScore" } }
).sort({ score: { $meta: "textScore" } })</div>
                            </div>

                            <div class="info-box">
                                <strong>Requiere √≠ndice de texto:</strong>
                                <div class="code-block" style="margin-top: 10px;">
db.articulos.createIndex({ titulo: "text", contenido: "text" })
                                </div>
                            </div>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testBuscarTexto()">
                                    Probar Text Search
                                </button>
                            </div>
                            <div id="result-texto" class="result"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== TAB: AGGREGATION ==================== -->
            <div id="tab-aggregation" class="tab-content">
                <div class="section">
                    <h2>Aggregation Pipeline</h2>

                    <div class="info-box">
                        <h4>¬øQu√© es Aggregation Pipeline?</h4>
                        <p>Un framework para procesamiento de datos que permite transformar y analizar documentos 
                        mediante una secuencia de etapas (stages). Similar a tuber√≠as en Unix.</p>
                    </div>

                    <!-- Estad√≠sticas por Categor√≠a -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/estadisticas/categoria</span>
                            </div>
                            <div class="description">
                                <strong>Aggregation:</strong> Estad√≠sticas agrupadas por categor√≠a
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Aggregation Pipeline Completo:</div>
                                <div class="code-block">db.articulos.aggregate([
  // Stage 1: $match - Filtrar documentos
  {
    $match: { publicado: true }
  },
  
  // Stage 2: $group - Agrupar y calcular
  {
    $group: {
      _id: "$categoria",
      total: { $sum: 1 },
      totalVisitas: { $sum: "$visitas" },
      promedioVisitas: { $avg: "$visitas" },
      visitasMax: { $max: "$visitas" },
      visitasMin: { $min: "$visitas" }
    }
  },
  
  // Stage 3: $project - Seleccionar campos
  {
    $project: {
      _id: 0,
      categoria: "$_id",
      totalArticulos: "$total",
      totalVisitas: 1,
      promedioVisitas: { $round: ["$promedioVisitas", 2] }
    }
  },
  
  // Stage 4: $sort - Ordenar resultados
  {
    $sort: { totalArticulos: -1 }
  }
])</div>
                            </div>

                            <div class="grid" style="margin-top: 20px;">
                                <div class="card">
                                    <h4>$match</h4>
                                    <p>Filtra documentos como <code>find()</code></p>
                                    <div class="code-block" style="margin-top: 10px;">
{ $match: { publicado: true } }
                                    </div>
                                </div>
                                <div class="card">
                                    <h4>$group</h4>
                                    <p>Agrupa y calcula estad√≠sticas</p>
                                    <div class="code-block" style="margin-top: 10px;">
{
  $group: {
    _id: "$categoria",
    total: { $sum: 1 }
  }
}
                                    </div>
                                </div>
                                <div class="card">
                                    <h4>$project</h4>
                                    <p>Selecciona y transforma campos</p>
                                    <div class="code-block" style="margin-top: 10px;">
{
  $project: {
    _id: 0,
    nombre: "$_id"
  }
}
                                    </div>
                                </div>
                                <div class="card">
                                    <h4>$sort</h4>
                                    <p>Ordena resultados</p>
                                    <div class="code-block" style="margin-top: 10px;">
{ $sort: { total: -1 } }
// -1 = descendente
// 1 = ascendente
                                    </div>
                                </div>
                            </div>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testEstadisticas()">
                                    Ver Estad√≠sticas
                                </button>
                            </div>
                            <div id="result-estadisticas" class="result"></div>
                        </div>
                    </div>

                    <!-- Top Art√≠culos -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title">
                                <span class="method get">GET</span>
                                <span class="url">/api/estadisticas/mas-vistos?limite=5</span>
                            </div>
                            <div class="description">
                                <strong>Aggregation con $limit:</strong> Top art√≠culos m√°s visitados
                            </div>
                        </div>
                        <div class="endpoint-body">
                            <div class="mongodb-query">
                                <div class="mongodb-query-title">üîç Pipeline con $limit:</div>
                                <div class="code-block">db.articulos.aggregate([
  { $match: { publicado: true } },
  { $sort: { visitas: -1 } },
  { $limit: 5 },
  {
    $project: {
      titulo: 1,
      autor: 1,
      visitas: 1
    }
  }
])</div>
                            </div>

                            <div class="btn-container">
                                <button class="btn-test" onclick="testMasVistos()">
                                    Ver Top 5 M√°s Vistos
                                </button>
                            </div>
                            <div id="result-masvistos" class="result"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== TAB: INTRODUCCI√ìN ==================== -->
            <div id="tab-intro" class="tab-content">
                <div class="section">
                    <h2>MongoDB Query Language (MQL) y BSON</h2>
                    
                    <div class="highlight-mongodb">
                        <h3>¬øQu√© hace especial a MongoDB?</h3>
                        <p style="font-size: 1.1em; line-height: 1.8;">
                            MongoDB utiliza <strong>BSON (Binary JSON)</strong> como formato de almacenamiento y 
                            <strong>MQL (MongoDB Query Language)</strong> para consultas, ofreciendo una experiencia 
                            intuitiva y poderosa basada en documentos JSON.
                        </p>
                    </div>

                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th style="width: 25%;">Caracter√≠stica</th>
                                <th style="width: 37.5%;">SQL Tradicional</th>
                                <th style="width: 37.5%;">MongoDB (MQL + BSON)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Formato</strong></td>
                                <td>Tablas con filas y columnas</td>
                                <td>Colecciones con documentos BSON</td>
                            </tr>
                            <tr>
                                <td><strong>Esquema</strong></td>
                                <td>R√≠gido, predefinido</td>
                                <td>Flexible, din√°mico</td>
                            </tr>
                            <tr>
                                <td><strong>Consulta Simple</strong></td>
                                <td><code>SELECT * FROM users WHERE age > 18</code></td>
                                <td><code>{ age: { $gt: 18 } }</code></td>
                            </tr>
                            <tr>
                                <td><strong>Inserci√≥n</strong></td>
                                <td><code>INSERT INTO users VALUES (...)</code></td>
                                <td><code>{ name: "Juan", age: 25 }</code></td>
                            </tr>
                            <tr>
                                <td><strong>Agregaci√≥n</strong></td>
                                <td><code>GROUP BY, HAVING, JOIN</code></td>
                                <td>Pipeline: <code>$match, $group, $project</code></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="grid">
                        <div class="card">
                            <h4>BSON - Binary JSON</h4>
                            <p>Formato binario optimizado que extiende JSON con:</p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>ObjectId:</strong> IDs √∫nicos de 12 bytes</li>
                                <li><strong>Date:</strong> Timestamps precisos</li>
                                <li><strong>Binary:</strong> Datos binarios eficientes</li>
                                <li><strong>Performance:</strong> 2-3x m√°s r√°pido que JSON</li>
                            </ul>
                        </div>
                        <div class="card">
                            <h4>MQL - Query Language</h4>
                            <p>Lenguaje de consultas basado en JSON que permite:</p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>Sintaxis intuitiva:</strong> Similar a JavaScript</li>
                                <li><strong>Operadores ricos:</strong> $gt, $in, $regex, etc.</li>
                                <li><strong>Consultas complejas:</strong> Nested queries</li>
                                <li><strong>Aggregation:</strong> Pipeline poderoso</li>
                            </ul>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>Ejemplo de BSON en Acci√≥n</h4>
                        <p>Cuando env√≠as este JSON:</p>
                        <div class="code-block" style="margin-top: 10px;">
{
  "titulo": "Mi art√≠culo",
  "fecha": "2025-12-14",
  "autor": "Juan"
}
                        </div>
                        <p style="margin-top: 10px;">MongoDB lo almacena como BSON con:</p>
                        <div class="code-block" style="margin-top: 10px;">
{
  "_id": ObjectId("675d1234567890abcdef1234"),
  "titulo": "Mi art√≠culo",
  "fecha": ISODate("2025-12-14T00:00:00Z"),
  "autor": "Juan"
}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PARA EDITAR -->
    <div id="modal-update" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Art√≠culo</h3>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            
            <form id="form-update" class="interactive-form">
                <input type="hidden" id="update-id">
                
                <div class="form-group">
                    <label for="update-titulo">T√≠tulo del Art√≠culo</label>
                    <input type="text" id="update-titulo" required>
                </div>

                <div class="form-group">
                    <label for="update-contenido">Contenido</label>
                    <textarea id="update-contenido" required></textarea>
                </div>

                <div class="form-group">
                    <label for="update-autor">Autor</label>
                    <input type="text" id="update-autor" required>
                </div>

                <div class="form-group">
                    <label for="update-categoria">Categor√≠a</label>
                    <select id="update-categoria">
                        <option value="Tecnolog√≠a">Tecnolog√≠a</option>
                        <option value="Ciencia">Ciencia</option>
                        <option value="Educaci√≥n">Educaci√≥n</option>
                        <option value="Deportes">Deportes</option>
                        <option value="Arte">Arte</option>
                        <option value="Salud">Salud</option>
                    </select>
                </div>

                <div class="mongodb-query">
                    <div class="mongodb-query-title">üîç Query MQL que se ejecuta:</div>
                    <div class="code-block">db.articulos.findByIdAndUpdate(
  "id_del_articulo",
  {
    $set: {
      titulo: "Nuevo t√≠tulo",
      contenido: "Nuevo contenido",
      autor: "Nuevo autor",
      categoria: "Nueva categor√≠a"
    }
  },
  { new: true, runValidators: true }
)</div>
                </div>

                <div class="btn-container">
                    <button type="submit" id="update-btn" class="btn-primary">
                        Guardar Cambios
                    </button>
                    <button type="button" class="btn-delete" onclick="closeEditModal()">
                        Cancelar
                    </button>
                </div>

                <div id="result-update" class="result"></div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
